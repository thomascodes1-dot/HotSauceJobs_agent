{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4">
    <h1 class="text-3xl font-bold mb-6 text-blue-800">Job Search</h1>
    
    <div class="mb-8">
        <form id="search-form" class="flex max-w-md">
            <input type="text" id="search-input" name="q" value="{{ query }}" placeholder="Enter job title or keywords" class="flex-grow px-4 py-2 rounded-l-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 border-2 border-blue-500">
            <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded-r-lg hover:bg-blue-600 transition duration-300">Search</button>
        </form>
    </div>

    <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Search results will be dynamically inserted here -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.getElementById('search-form');
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');

    let debounceTimer;

    searchInput.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(performSearch, 300);
    });

    searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        performSearch();
    });

    function performSearch() {
        const query = searchInput.value.trim();
        if (query) {
            fetch(`/api/search?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(jobs => {
                    displaySearchResults(jobs);
                })
                .catch(error => {
                    console.error('Error fetching search results:', error);
                });
        } else {
            searchResults.innerHTML = '';
        }
    }

    function displaySearchResults(jobs) {
        searchResults.innerHTML = '';
        if (jobs.length === 0) {
            searchResults.innerHTML = '<p class="text-gray-600 col-span-3">No jobs found matching your search criteria.</p>';
            return;
        }
        jobs.forEach(job => {
            const jobElement = document.createElement('div');
            jobElement.className = 'bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition duration-300';
            jobElement.innerHTML = `
                <h2 class="text-xl font-semibold mb-2 text-blue-600">${job.title}</h2>
                <h3 class="text-lg text-gray-600 mb-2">${job.company}</h3>
                <p class="text-gray-600 mb-4">${job.description.substring(0, 100)}${job.description.length > 100 ? '...' : ''}</p>
                <div class="flex justify-between items-center">
                    <a href="/company/${job.company_id}" class="text-blue-500 hover:underline">View Company</a>
                    <a href="/apply/${job.id}" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-300">Apply</a>
                </div>
            `;
            searchResults.appendChild(jobElement);
        });
    }

    // Perform initial search if there's a query in the URL
    if (searchInput.value) {
        performSearch();
    }
});
</script>
{% endblock %}
